<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> NSProxy——少见却神奇的类 · JOJOTOV</title><meta name="description" content="nsproxy,NSProxy,proxy"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/official_account_avatar.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://dingtz.com/atom.xml" title="JOJOTOV"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/blogLogo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jojoting" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://cn.linkedin.com/in/同舟-丁-77689b10b" target="_blank" class="nav-list-link">LINKEDIN</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">NSProxy——少见却神奇的类</h1><div class="post-info">Aug 9, 2016</div><div class="post-content"><p>众所周知，NSObject类是Objective-C中大部分类的基类。但不是很多人知道除了NSObject之外的另一个基类——NSProxy<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NS_ROOT_CLASS</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSProxy</span> &lt;<span class="title">NSObject</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这个奇怪的类是干嘛的？请允许我做一个黑人问号脸<br>马上查了一下Apple的官方文档：<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSProxy_Class/" target="_blank" rel="external">NSProxy</a></p>
<blockquote>
<p>NSProxy is an abstract superclass defining an API for objects that act as stand-ins for other objects or for objects that don’t exist yet. Typically, a message to a proxy is forwarded to the real object or causes the proxy to load (or transform itself into) the real object. Subclasses of NSProxy can be used to implement transparent distributed messaging (for example, <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSDistantObject_Class/index.html#//apple_ref/occ/cl/NSDistantObject" target="_blank" rel="external">NSDistantObject</a>) or for lazy instantiation of objects that are expensive to create.</p>
</blockquote>
<p>总的来说，NSProxy是一个虚类，你可以通过继承它，并重写这两个方法以实现消息转发到另一个实例<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)anInvocation;</div><div class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)sel;</div></pre></td></tr></table></figure></p>
<p>现在NSProxy的真面目终于浮出水面：<strong>负责将消息转发到真正的target的代理类</strong>。举个例子，你想要卖一件二手物品，但是你并不想直接跟卖家接触<strong>（直接向target发消息）</strong>，这时你去找了一个第三方，你告诉这个第三方你要买什么、出多少钱买、什么时候要等<strong>（向代理发消息）</strong>，第三方再去跟卖家接触并把这些信息转告卖家<strong>（转发消息给真实的target）</strong>，最后通过第三方去完成这个交易。</p>
<p>了解完NSProxy是是什么以后，那么它究竟能帮我们干些什么呢？</p>
<p>##通过NSProxy在Objective-C中模拟多继承</p>
<p>多继承在编程中可以说是比较有用的特性。举个例子，原本有两个相互独立的类A和类B，它们各自继承各自的父类，项目进行地好好的，突然有一天产品经理过来告诉你，我要在下个版本加一个xxxxx的特性，非常紧急。一脸懵逼的你发现如果要实现这个特性，你需要对类A以及其父类作很大的修改，代价非常之高。突然你意识到原来类B的父类已经有类似的功能，你只需要让类A继承于类B的父类并重写其某些方法就能实现，这样做高效且低风险，于是你屁颠屁颠地撸起了代码。</p>
<p>可是，Objective-C却不支持这样一个强大的特性。不过NSProxy可以帮我们在某种程度上（这只是一个模拟的多继承，并不是完全的多继承）解决这个问题：</p>
<p><code>现在假设我们想要去买书，但是我懒癌犯了，不想直接去书店（供应商）买，如果有一个跑腿的人（经销商）帮我去书店买完，我再跟他买。同时，我买完书又想买件衣服，我又可以很轻松地在他那里买到一件衣服（多继承）。</code></p>
<p>首先，我们定义BookProvider类与ClothesProvider类作为基类。<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  TDBookProvider.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TDBookProviderProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseBookWithTitle:(<span class="built_in">NSString</span> *)bookTitle;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDBookProvider</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  TDClothesProvider.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span> (<span class="built_in">NSInteger</span>, TDClothesSize)&#123;</div><div class="line">    TDClothesSizeSmall = <span class="number">0</span>,</div><div class="line">    TDClothesSizeMedium,</div><div class="line">    TDClothesSizeLarge</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TDClothesProviderProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseClothesWithSize:(TDClothesSize )size;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDClothesProvider</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>这里要注意：<strong>一定要通过protocol来声明接口，而不是直接在类的@interfere中定义。</strong>因为通过protocol来声明接口，然后让proxy类遵循此协议，可以骗过编译器防止编译器提示proxy类未声明接口的错误。这个问题下面可以看到。</p>
<p>然后是这两个类的实现<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  TDBookProvider.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TDBookProvider.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDBookProvider</span> () &lt;<span class="title">TDBookProviderProtocol</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TDBookProvider</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseBookWithTitle:(<span class="built_in">NSString</span> *)bookTitle&#123;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"You've bought \"%@\""</span>,bookTitle);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  TDClothesProvider.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TDClothesProvider.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDClothesProvider</span> () &lt;<span class="title">TDClothesProviderProtocol</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TDClothesProvider</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseClothesWithSize:(TDClothesSize )size&#123;</div><div class="line">    <span class="built_in">NSString</span> *sizeStr;</div><div class="line">    <span class="keyword">switch</span> (size) &#123;</div><div class="line">        <span class="keyword">case</span> TDClothesSizeLarge:</div><div class="line">            sizeStr = <span class="string">@"large size"</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> TDClothesSizeMedium:</div><div class="line">            sizeStr = <span class="string">@"medium size"</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">case</span> TDClothesSizeSmall:</div><div class="line">            sizeStr = <span class="string">@"small size"</span>;</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">        <span class="keyword">default</span>:</div><div class="line">            <span class="keyword">break</span>;</div><div class="line">    &#125;</div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"You've bought some clothes of %@"</span>,sizeStr);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>现在两个Provider的类写完，我们可以直接向供应商买东西了，但这跟我们的需求还有很大差异，我们需要一个中间的经销商<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  TDDealerProxy.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"TDBookProvider.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"TDClothesProvider.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDDealerProxy</span> : <span class="title">NSProxy</span> &lt;<span class="title">TDBookProviderProtocol</span>, <span class="title">TDClothesProviderProtocol</span>&gt;</span></div><div class="line"></div><div class="line">+ (<span class="keyword">instancetype</span> )dealerProxy;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>这里有两个要注意的问题：<br>1、TDDealerProxy这个子类必须要遵循之前定义的两个协议TDBookProviderProtocol与TDClothesProviderProtocol，目的是骗过编译器，让编译器认为这个类实现了上面两个协议<br>2、NSProxy类是没有init方法的，也就是说如果我们要获得一个NSProxy的实例，代码只需要这样：<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSProxy</span> *proxyInstance = [<span class="built_in">NSProxy</span> alloc];</div></pre></td></tr></table></figure></p>
<p>接下来看实现文件<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//  TDDealerProxy.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TDDealerProxy.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDDealerProxy</span> () </span>&#123;</div><div class="line">    TDBookProvider          *_bookProvider;</div><div class="line">    TDClothesProvider       *_clothesProvider;</div><div class="line">    <span class="built_in">NSMutableDictionary</span>     *_methodsMap;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TDDealerProxy</span></span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - class method</span></div><div class="line">+ (<span class="keyword">instancetype</span>)dealerProxy&#123;</div><div class="line">    <span class="keyword">return</span> [[TDDealerProxy alloc] init];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - init</span></div><div class="line">- (<span class="keyword">instancetype</span>)init&#123;</div><div class="line">    _methodsMap = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">    _bookProvider = [[TDBookProvider alloc] init];</div><div class="line">    _clothesProvider = [[TDClothesProvider alloc] init];</div><div class="line"></div><div class="line">    <span class="comment">//映射target及其对应方法名</span></div><div class="line">    [<span class="keyword">self</span> _registerMethodsWithTarget:_bookProvider];</div><div class="line">    [<span class="keyword">self</span> _registerMethodsWithTarget:_clothesProvider];</div><div class="line"></div><div class="line">    <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - private method</span></div><div class="line">- (<span class="keyword">void</span>)_registerMethodsWithTarget:(<span class="keyword">id</span> )target&#123;</div><div class="line">    </div><div class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> numberOfMethods = <span class="number">0</span>;</div><div class="line">    </div><div class="line">    <span class="comment">//获取target方法列表</span></div><div class="line">    Method *method_list = class_copyMethodList([target <span class="keyword">class</span>], &amp;numberOfMethods);</div><div class="line">    </div><div class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfMethods; i ++) &#123;</div><div class="line">        <span class="comment">//获取方法名并存入字典</span></div><div class="line">        Method temp_method = method_list[i];</div><div class="line">        SEL temp_sel = method_getName(temp_method);</div><div class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *temp_method_name = sel_getName(temp_sel);</div><div class="line">        [_methodsMap setObject:target forKey:[<span class="built_in">NSString</span> stringWithUTF8String:temp_method_name]];</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    free(method_list);</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - NSProxy override methods</span></div><div class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)invocation&#123;</div><div class="line">    <span class="comment">//获取当前选择子</span></div><div class="line">    SEL sel = invocation.selector;</div><div class="line">    </div><div class="line">    <span class="comment">//获取选择子方法名</span></div><div class="line">    <span class="built_in">NSString</span> *methodName = <span class="built_in">NSStringFromSelector</span>(sel);</div><div class="line">    </div><div class="line">    <span class="comment">//在字典中查找对应的target</span></div><div class="line">    <span class="keyword">id</span> target = _methodsMap[methodName];</div><div class="line">    </div><div class="line">    <span class="comment">//检查target</span></div><div class="line">    <span class="keyword">if</span> (target &amp;&amp; [target respondsToSelector:sel]) &#123;</div><div class="line">        [invocation invokeWithTarget:target];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        [<span class="keyword">super</span> forwardInvocation:invocation];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)sel&#123;</div><div class="line">    <span class="comment">//获取选择子方法名</span></div><div class="line">    <span class="built_in">NSString</span> *methodName = <span class="built_in">NSStringFromSelector</span>(sel);</div><div class="line">    </div><div class="line">    <span class="comment">//在字典中查找对应的target</span></div><div class="line">    <span class="keyword">id</span> target = _methodsMap[methodName];</div><div class="line"></div><div class="line">    <span class="comment">//检查target</span></div><div class="line">    <span class="keyword">if</span> (target &amp;&amp; [target respondsToSelector:sel]) &#123;</div><div class="line">        <span class="keyword">return</span> [target methodSignatureForSelector:sel];</div><div class="line">    &#125; <span class="keyword">else</span> &#123;</div><div class="line">        <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:sel];</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>大功告成，现在我们的经销商也有了，最后要做的就是告诉经销商我们要买什么书跟什么衣服了（发消息）<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</div><div class="line">    </div><div class="line">    TDDealerProxy *dealerProxy = [TDDealerProxy dealerProxy];</div><div class="line">    [dealerProxy purchaseBookWithTitle:<span class="string">@"Swift 100 Tips"</span>];</div><div class="line">    [dealerProxy purchaseClothesWithSize:TDClothesSizeMedium];</div><div class="line"></div><div class="line">    <span class="comment">// Override point for customization after application launch.</span></div><div class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>运行看看log：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-08-06 01:10:27.095 TDProxyDemo[37732:924470] You&apos;ve bought &quot;Swift 100 Tips&quot;</div><div class="line">2016-08-06 01:10:27.095 TDProxyDemo[37732:924470] You&apos;ve bought some clothes of medium size</div></pre></td></tr></table></figure></p>
<p>Bravo！<a href="https://github.com/jojoting/TDProxyDemo" target="_blank" rel="external">Demo地址戳我</a></p>
<p>总的来说，NSProxy这个在日常开发者很少见的类，的确有着它奇淫之处，这里推荐几个NSProxy相关的实践</p>
<p><a href="http://blog.sunnyxx.com/2014/08/24/objc-duck/" target="_blank" rel="external">objc与鸭子对象 by sunny</a><br><a href="https://github.com/zwaldowski/BlocksKit" target="_blank" rel="external">BlocksKit by zwaldowski</a><br>附上个人觉得写得很好的一篇源码解析：<br><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/BlocksKit/%E7%A5%9E%E5%A5%87%E7%9A%84%20BlocksKit%20%EF%BC%88%E4%B8%80%EF%BC%89.md" target="_blank" rel="external">BlocksKit源码解析：《神奇的BlocksKit by Draveness》</a></p>
<a id="more"></a>
</div></article></div></section><footer><div class="paginator"><a href="/2016/12/18/使用presentingViewcontroller属性可能会遇到的坑/" class="prev">PREV</a><a href="/2016/07/20/阿里云服务器配置pptp-vpn/" class="next">NEXT</a></div><div class="copyright"><p>© 2016 <a href="https://dingtz.com">Jojo Ding</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>