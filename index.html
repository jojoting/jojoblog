<!DOCTYPE html><html><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> JOJOTOV</title><meta name="description" content="A Blog Powered By Hexo"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/official_account_avatar.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="search" type="application/opensearchdescription+xml" href="https://dingtz.com/atom.xml" title="JOJOTOV"></head><body><div class="wrap"><header><a href="/" class="logo-link"><img src="/blogLogo.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link active">BLOG</a></li><li class="nav-list-item"><a href="/archives/" target="_self" class="nav-list-link">ARCHIVE</a></li><li class="nav-list-item"><a href="https://github.com/jojoting" target="_blank" class="nav-list-link">GITHUB</a></li><li class="nav-list-item"><a href="https://cn.linkedin.com/in/åŒèˆŸ-ä¸-77689b10b" target="_blank" class="nav-list-link">LINKEDIN</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li></ul></header><section class="container"><ul class="home post-list"><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/12/18/Linkï¼ˆç›´è¾¾é“¾æ¥ï¼‰å¼€å‘/" class="post-title-link">iOS9 UniversalLinkï¼ˆç›´è¾¾é“¾æ¥ï¼‰å¼€å‘</a></h2><div class="post-info">Dec 18, 2016</div><div class="post-content"><p>###èƒŒæ™¯<br>åœ¨iOS 9ä»¥å‰ï¼Œæˆ‘ä»¬ä»å¤–éƒ¨å¯åŠ¨Appéƒ½æ˜¯é€šè¿‡URL Schemeå®ç°è·³è½¬çš„ã€‚è¿™ç§æ–¹å¼è™½ç„¶å¯è‡ªå®šç¨‹åº¦å¾ˆé«˜ï¼Œèƒ½å¤Ÿå·§å¦™åœ°å®ç°å¾ˆå¤šè·³è½¬ï¼Œä½†å¼Šç«¯ä¹Ÿå¾ˆæ˜æ˜¾ï¼šæˆ‘ä»¬åªèƒ½é€šè¿‡scheme://exampleè¿™ç§æ ¼å¼çš„é“¾æ¥æ¥å®ç°è·³è½¬ï¼Œè€Œä¸”ç°åœ¨è‹¹æœè¿˜å¯¹è¿™ç§æ–¹å¼çš„è·³è½¬åŠ äº†ä¸€ä¸ªæç¤ºæ¡†ï¼šâ€œæ˜¯å¦æ‰“å¼€XXXâ€ã€‚å¯¹äºå¯¹Webå’ŒåŸç”ŸAppäº¤äº’çš„åœºæ™¯éœ€æ±‚é‡å¾ˆå¤§çš„äº§å“æ¥è¯´ï¼Œè¿™æ ·çš„è·³è½¬æ–¹å¼æ˜¾ç„¶æ˜¯æ­¥éª¤å†—æ‚çš„ï¼Œç”¨æˆ·ä½“éªŒå¹¶ä¸å¥½ã€‚</p>
<p>iOS 9ä»¥åï¼ŒUniversal Linkçš„å‡ºç°è§£å†³äº†è¿™ä¸ªé—®é¢˜ã€‚å®ƒæ‰€æä¾›çš„ç›´æ¥ã€é¡ºç•…ã€æ— ç¼è¡”æ¥çš„è·³è½¬èƒ½å¤Ÿè®©ç”¨æˆ·ä½“éªŒæå‡ä¸€ä¸ªçº§åˆ«ã€‚ç”¨æˆ·å¯ä»¥ç‚¹å‡»å¼€å‘è€…æŒ‡å®šçš„ç±»ä¼¼äº<code>https://example.com/t</code>çš„URLç›´æ¥å”¤é†’Appï¼Œè€Œä¸éœ€è¦åœ¨æµè§ˆå™¨æ‰“å¼€å†ç‚¹å‡»å…¶ä»–æŒ‰é’®ã€‚</p>
<p>åœ¨ä½ çš„Appä¸­æ·»åŠ è¿™ä¸ªåŠŸèƒ½å¾ˆç®€å•ï¼š</p>
<blockquote>
<ul>
<li><p>åœ¨<a href="https://developer.apple.com/account/">è‹¹æœå¼€å‘è€…ç½‘ç«™</a>ä¸­æ‰“å¼€éœ€è¦ä½¿ç”¨Universal LinkåŠŸèƒ½çš„Appä¸­çš„Associated Domains</p>
</li>
<li><p>ä¸Šä¼ apple-app-site-associationåˆ°æœåŠ¡å™¨æ ¹ç›®å½•ä¸‹</p>
</li>
<li><p>åœ¨AppDelegateä¸­å®ç°ç›¸åº”çš„æ–¹æ³•</p>
</li>
</ul>
</blockquote>
<p>###é…ç½®<br>é¦–å…ˆï¼Œæˆ‘ä»¬è¦åœ¨<a href="https://developer.apple.com/account/">è‹¹æœå¼€å‘è€…ç½‘ç«™</a>ä¸­å¼€å¯Appçš„Associated DomainsåŠŸèƒ½ã€‚</p>
<p>åœ¨<em>Account -&gt; Certificates, Identifiers &amp; Profiles -&gt; App IDs -&gt; YourApp -&gt; Edit</em>ä¸­æŠŠAssociated Domainsè®¾ç½®ä¸ºEnable</p>
<p>ç„¶åæˆ‘ä»¬éœ€è¦é…ç½®ä¸€ä¸‹å·¥ç¨‹æ–‡ä»¶ï¼Œæ‰¾åˆ°<em>Capabilities -&gt; Associated Domains</em></p>
<p>æ‰“å¼€æ­¤åŠŸèƒ½å¹¶æŠŠä½ éœ€è¦è·³è½¬çš„domainåŠ è¿›å»ï¼Œæ ¼å¼ä¸º<code>applinks://www.example.com</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/797083-d529f0746b0b6cc0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Paste_Image.png"></p>
<p>###éƒ¨ç½²</p>
<blockquote>
<p>####æ³¨æ„</p>
<p>é¦–å…ˆä½ çš„æœåŠ¡å™¨å¿…é¡»å¾—æ”¯æŒSSL</p>
</blockquote>
<p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸Šä¼ ä¸€ä¸ªjsonæ–‡ä»¶åˆ°æˆ‘ä»¬çš„æœåŠ¡å™¨ã€‚jsonæ–‡ä»¶ä»¥apple-app-site-associationå‘½å</p>
<blockquote>
<p>####æ³¨æ„</p>
<p>æ–‡ä»¶ä¸éœ€è¦æ·»åŠ ä»»ä½•åç¼€</p>
</blockquote>
<p>jsonçš„æ ¼å¼æ˜¯è¿™æ ·çš„:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line">Â  &quot;applinks&quot;: &#123;</div><div class="line">Â  Â  &quot;apps&quot;: [],</div><div class="line">Â  Â  &quot;details&quot;: [</div><div class="line">Â  Â  Â  &#123;</div><div class="line">Â  Â  Â  Â  &quot;appID&quot;: &quot;TeamID.com.domain.App&quot;,</div><div class="line">Â  Â  Â  Â  &quot;paths&quot;:[ &quot;*&quot; ]</div><div class="line">Â  Â  Â  &#125;</div><div class="line">Â  Â  ]</div><div class="line">Â  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li><p><code>appID</code>ï¼šTeamIDåŠ ä¸ŠBundle ID</p>
</li>
<li><p><code>paths</code>ï¼šæ”¯æŒUniversal Linkï¼Œä¹Ÿå°±æ˜¯å¯ä»¥è·³è½¬çš„è·¯å¾„ã€‚<code>*</code>ä»£è¡¨æ­¤åŸŸåä¸‹æ‰€æœ‰è·¯å¾„éƒ½æ”¯æŒï¼Œä¹Ÿå¯ä»¥å…·ä½“åˆ¶å®šåˆ°æŸä¸ªé¡µé¢ä¾‹å¦‚<code>/path/page</code>æˆ–è€…æŸä¸ªè·¯å¾„ä¸‹æ‰€æœ‰URLä¾‹å¦‚<code>/path/*</code></p>
</li>
</ul>
<p>å…³äº<code>paths</code>çš„é…ç½®ï¼Œå¯ä»¥å‚è€ƒè‹¹æœå®˜æ–¹æ–‡æ¡£</p>
<blockquote>
<ul>
<li><p>Use * to specify your entire website</p>
</li>
<li><p>Include a specific URL, such as /wwdc/news/, to specify a particular link</p>
</li>
<li><p>Append <em> to a specific URL, such as /videos/wwdc/2015/</em>, to specify a section of your website</p>
</li>
<li><p>In addition to using <em> to match any substring, you can also use ? to match any single character. You can combine both wildcards in a single path, such as /foo/</em>/bar/201?/mypage.</p>
</li>
</ul>
</blockquote>
<p>æœ€åï¼Œæˆ‘ä»¬åªéœ€è¦æŠŠé…ç½®å¥½çš„jsonæ–‡ä»¶ä¸Šä¼ åˆ°æœåŠ¡å™¨ä¸­è¯¥åŸŸåçš„æ ¹ç›®å½•ä¸‹ï¼Œè¨€ä¸‹ä¹‹æ„ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨GETè¯·æ±‚å¯ä»¥è·å–åˆ°<code>https://www.example.com/apple-app-association</code> </p>
<blockquote>
<p><strong>å†æ¬¡å¼ºè°ƒå¿…é¡»æ˜¯HTTPSåè®®</strong></p>
</blockquote>
<p>å½“æˆ‘ä»¬çš„Appåœ¨è®¾å¤‡ä¸Šç¬¬ä¸€æ¬¡è¿è¡Œæ—¶ï¼Œå¦‚æœæ”¯æŒAssociated DomainsåŠŸèƒ½ï¼Œé‚£ä¹ˆiOSä¼šè‡ªåŠ¨å»GETå®šä¹‰çš„Domainä¸‹çš„<code>apple-app-site-association</code>æ–‡ä»¶ã€‚</p>
<p>éœ€è¦ç•™æ„iOSä¼šå…ˆè¯·æ±‚<code>https://domain.com/.well-known/apple-app-site-association</code>å¦‚æœæ­¤æ–‡ä»¶è¯·æ±‚ä¸åˆ°ï¼Œå†å»è¯·æ±‚<code>https://domain.com/apple-app-site-association</code></p>
<p>æ‰€ä»¥å¦‚æœæƒ³è¦é¿å…æœåŠ¡å™¨æ¥æ”¶è¿‡å¤šGETè¯·æ±‚ï¼Œå¯ä»¥ç›´æ¥æŠŠ<code>apple-app-site-association</code>æ”¾åœ¨<code>./well-known/</code>ç›®å½•ä¸‹</p>
<blockquote>
<p>####æ³¨æ„</p>
<p>æœåŠ¡å™¨ä¸Š<code>apple-app-site-association</code>çš„æ›´æ–°ä¸ä¼šè®©iOSæœ¬åœ°çš„<code>apple-app-site-association</code>åŒæ­¥æ›´æ–°ï¼Œå³iOSåªä¼šåœ¨Appç¬¬ä¸€æ¬¡å¯åŠ¨æ—¶è¯·æ±‚ä¸€æ¬¡ï¼Œä»¥åé™¤éAppæ›´æ–°æˆ–é‡æ–°å®‰è£…å¦åˆ™ä¸ä¼šåœ¨æ¯æ¬¡æ‰“å¼€æ—¶è¯·æ±‚<code>apple-app-site-association</code></p>
</blockquote>
<p>###å¼€å‘<br>å¾…æˆ‘ä»¬æœåŠ¡å™¨éƒ¨ç½²å¥½äº†ï¼Œç”¨curlæµ‹è¯•ä¸€ä¸‹<code>apple-app-site-association</code>èƒ½å¤Ÿæ­£ç¡®GETåˆ°äº†,é‚£ä¹ˆæˆ‘ä»¬å°±éœ€è¦åœ¨å·¥ç¨‹ä¸­å“åº”è·³è½¬äº‹ä»¶äº†ã€‚</p>
<p>æˆ‘ä»¬åœ¨AppDelegateä¸­å®ç°å¦‚ä¸‹ä»£ç†æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application continueUserActivity:(<span class="built_in">NSUserActivity</span> *)userActivity restorationHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span> * _Nullable))restorationHandler&#123;</div></pre></td></tr></table></figure>
<p>å…·ä½“å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application continueUserActivity:(<span class="built_in">NSUserActivity</span> *)userActivity restorationHandler:(<span class="keyword">void</span> (^)(<span class="built_in">NSArray</span> * _Nullable))restorationHandler&#123;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">if</span> (![userActivity.activityType isEqualToString:<span class="built_in">NSUserActivityTypeBrowsingWeb</span>]) &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">Â  Â  &#125;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">//è¯»å–urlåœ°å€</span></div><div class="line">Â  Â  <span class="built_in">NSURL</span> *webUrl = userActivity.webpageURL;</div><div class="line">Â Â  Â </div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">if</span> (![webUrl.path isEqualToString:<span class="string">@"/show"</span>]) &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">//pathé”™è¯¯ï¼Œç›´æ¥ä»safariæ‰“å¼€</span></div><div class="line">Â  Â  Â  Â  [[<span class="built_in">UIApplication</span> sharedApplication] openURL:webUrl];</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="comment">//è·³è½¬å¹¶æ˜¾ç¤ºå†…å®¹</span></div><div class="line">Â  Â  [[<span class="built_in">NSNotificationCenter</span> defaultCenter] postNotificationName:<span class="string">@"notify"</span> object:<span class="string">@"hello world"</span>];</div><div class="line"></div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„è‡ªç”±åº¦å°±å¾ˆé«˜äº†ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¼ å…¥çš„ä»»ä½•ç¬¦åˆè·³è½¬æ¡ä»¶çš„URLè¿›è¡Œä¸åŒçš„æ“ä½œã€‚</p>
<p>###æµ‹è¯•<br>ç°åœ¨ä¸€åˆ‡éƒ½å·²ç»å®Œæˆäº†ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥åœ¨çŸ­ä¿¡ä¸­ç‚¹å‡»ä¸€ä¸ªURLç›´æ¥è·³è½¬åˆ°æˆ‘ä»¬çš„Appã€‚è‡³äºå¦‚ä½•æ£€éªŒURLæ˜¯å¦èƒ½å¤Ÿè·³è½¬ï¼Œä¸€ä¸ªå¿«æ·æ–¹ä¾¿çš„æ–¹æ³•å°±æ˜¯åœ¨ç³»ç»ŸåŸç”ŸAppä¸­ï¼ˆå¦‚çŸ­ä¿¡ã€é‚®ä»¶ç­‰ï¼‰é•¿æŒ‰URLï¼Œå¦‚æœå¼¹å‡ºçš„é€‰é¡¹ä¸­æœ‰<strong><em>åœ¨â€œyour appâ€ä¸­æ‰“å¼€</em></strong>ï¼Œé‚£ä¹ˆè¯æ˜è¯¥URLæ˜¯æ”¯æŒè·³è½¬çš„ã€‚</p>
<blockquote>
<p>####æ³¨æ„</p>
<p>éç³»ç»ŸåŸç”ŸAppä¸ä¸€å®šèƒ½æ”¯æŒç›´æ¥ç‚¹å‡»URLè·³è½¬ï¼Œä¾‹å¦‚åœ¨å¾®ä¿¡ä¸­ç‚¹å‡»URLä¼šé¦–å…ˆåœ¨å¾®ä¿¡å†…çš„WebViewæ‰“å¼€ï¼Œå¦‚æœè¦è·³è½¬åªèƒ½å†é€šè¿‡Safariæ‰“å¼€ã€‚</p>
</blockquote></div><a href="/2016/12/18/Linkï¼ˆç›´è¾¾é“¾æ¥ï¼‰å¼€å‘/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/12/18/ä½¿ç”¨presentingViewcontrollerå±æ€§å¯èƒ½ä¼šé‡åˆ°çš„å‘/" class="post-title-link">ä½¿ç”¨presentingViewControllerå±æ€§å¯èƒ½ä¼šé‡åˆ°çš„å‘</a></h2><div class="post-info">Dec 18, 2016</div><div class="post-content"><h3 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h3><p>å‡è®¾ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªåœºæ™¯ï¼Œæˆ‘æœ‰ä¸€ä¸ªæ ¹å¯¼èˆªæ§åˆ¶å™¨<code>RootNavigationController</code>ï¼Œå®ƒçš„æ ¹è§†å›¾æ§åˆ¶å™¨<code>ViewController</code>æœ‰ä¸€ä¸ªå­æ§åˆ¶å™¨<code>UINavigationController</code>ï¼Œè¿™ä¸ªå¯¼èˆªæ§åˆ¶å™¨çš„æ ¹æ§åˆ¶å™¨æ˜¯<code>FirstViewController</code>ã€‚</p>
<p>åœ¨<code>FirstViewController</code>ä¸­ï¼Œæ·»åŠ ä¸€ä¸ªæ–¹æ³•ä½¿ç”¨<code>presentModelViewController</code>çš„æ–¹å¼è·³è½¬åˆ°å¦ä¸€ä¸ªæ ¹æ§åˆ¶å™¨ä¸º<code>NextViewController</code>çš„<code>UINavigationController</code></p>
<p><img src="http://upload-images.jianshu.io/upload_images/797083-a034d3bd0033a0a3.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="æ§åˆ¶å™¨å±‚çº§"></p>
<p>å¦‚æœ<code>NextViewController</code>ä¸­è·å–å®ƒçš„<code>presentingViewController</code>å±æ€§ï¼Œç»“æœå¾—åˆ°çš„æ˜¯<code>RootNavigationController</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2016-12-18 10:34:09.548 PresentVCDemo[27202:22455163] viewDidLoad &lt;RootNavigationController: 0x7ff29f83ba00&gt;</div><div class="line">2016-12-18 10:34:09.549 PresentVCDemo[27202:22455163] viewDidLoad &lt;ViewController: 0x7ff29de05870&gt;</div><div class="line">2016-12-18 10:34:09.572 PresentVCDemo[27202:22455163] viewDidLoad &lt;UINavigationController: 0x7ff29f022a00&gt;</div><div class="line">2016-12-18 10:34:09.573 PresentVCDemo[27202:22455163] viewDidLoad &lt;FirstViewController: 0x7ff29dc0c680&gt;</div><div class="line">2016-12-18 10:34:52.785 PresentVCDemo[27202:22455163] Presenting Controller : &lt;RootNavigationController: 0x7ff29f83ba00&gt;</div></pre></td></tr></table></figure>
<h3 id="åŸå› "><a href="#åŸå› " class="headerlink" title="åŸå› "></a>åŸå› </h3><p>è‹¹æœå®˜æ–¹çš„<a href="https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/PresentingaViewController.html#//apple_ref/doc/uid/TP40007457-CH14-SW7">ViewController Programming Guide</a>ä¸­å…³äº<strong>Presenting a View Controller</strong>çš„éƒ¨åˆ†æ˜¯è¿™æ ·è¯´çš„</p>
<blockquote>
<p>The view controller that calls the presentViewController:animated:completion: method may not be the one that actually performs the modal presentation. The presentation style determines how that view controller is to be presented, including the characteristics required of the presenting view controller. </p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨è°ƒç”¨<code>presentViewController:animated:completion:</code>æ–¹æ³•æ—¶ï¼ŒçœŸæ­£ä½œä¸ºè·³è½¬çš„å®¹å™¨å¹¶ä¸ä¸€å®šæ˜¯è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„view controllerï¼Œè€Œæ˜¯å–å†³äº<code>modalPresentationStyle</code>ã€‚ä¾‹å¦‚ï¼Œä¸€ä¸ªå…¨å±çš„è·³è½¬å¿…é¡»ç”±ä¸€ä¸ªå…¨å±çš„view controlleræ¥å®Œæˆã€‚å¦‚æœå½“å‰çš„æ§åˆ¶å™¨ä¸èƒ½æ»¡è¶³ï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šè‡ªåŠ¨æ²¿ç€è§†å›¾æ§åˆ¶å™¨çš„å±‚çº§å‘ä¸ŠæŸ¥æ‰¾ã€‚</p>
<p>åœ¨æˆ‘ä»¬çš„å±‚çº§ä¸­ï¼Œåªæœ‰ä¸¤ä¸ª<code>UINavigationController</code>æ˜¯å…¨å±çš„ï¼Œå› æ­¤ï¼Œè¿™ä¸¤ä¸ªæ§åˆ¶å™¨éƒ½æœ‰å¯èƒ½æˆä¸ºæœ€ç»ˆè·³è½¬çš„å®¹å™¨ã€‚å¯æ˜¯ä¸ºä»€ä¹ˆæœ€ç»ˆæ˜¯<code>RootNavigationController</code>å®Œæˆäº†è¿™æ¬¡è·³è½¬è€Œä¸æ˜¯<code>FirstViewController</code>çš„å¯¼èˆªæ§åˆ¶å™¨å‘¢ï¼Ÿ</p>
<p>åœ¨<a href="https://developer.apple.com/library/content/featuredarticles/ViewControllerPGforiPhoneOS/TheViewControllerHierarchy.html#//apple_ref/doc/uid/TP40007457-CH33-SW1">The View Controller Hierachy</a>å…³äºPresented View Controllerä¸­æ‰¾åˆ°äº†è¿™æ ·ä¸€å¥è¯ï¼š</p>
<blockquote>
<p>When you present a view controller, UIKit looks for a view controller that provides a suitable context for the presentation. In many cases, UIKit chooses the nearest container view controller but it might also choose the windowâ€™s root view controller.</p>
</blockquote>
<p>å› æ­¤ï¼Œåœ¨ä¸€å¼€å§‹æåˆ°çš„åœºæ™¯ä¸­ï¼ŒUIKitå¸®æˆ‘ä»¬é€‰æ‹©äº†UIWindowçš„æ ¹è§†å›¾æ§åˆ¶å™¨ï¼Œè€Œä¸æ˜¯<code>FirstViewController</code>çš„å¯¼èˆªæ§åˆ¶å™¨ã€‚</p>
<h3 id="è§£å†³"><a href="#è§£å†³" class="headerlink" title="è§£å†³"></a>è§£å†³</h3><p>åœ¨æŸäº›ç‰¹å®šçš„ä¸šåŠ¡éœ€æ±‚ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨<code>presentingViewController</code>æ‹¿åˆ°<code>FirstViewController</code>çš„å¯¼èˆªæ§åˆ¶å™¨ã€‚</p>
<p>è§£å†³è¿™ä¸ªéœ€æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°ä¸€å¯¹å±æ€§<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">BOOL</span> definesPresentationContext;</div><div class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>,<span class="keyword">assign</span>) <span class="built_in">UIModalPresentationStyle</span> modalPresentationStyle;</div></pre></td></tr></table></figure></p>
<p><code>modalPresentationStyle</code>å±æ€§å†³å®šäº†å°†è¦presentçš„æ§åˆ¶å™¨ä»¥ä½•ç§æ–¹å¼å±•ç°ï¼Œé»˜è®¤å€¼ä¸º<code>UIModalTransitionStyleCoverVertical</code></p>
<p><code>definesPresentationContext</code>å°±æœ‰ç‚¹ç¥å¥‡äº†ï¼Œä»–çš„æ³¨é‡Šæ–‡æ¡£æ˜¯è¿™ä¹ˆå†™çš„</p>
<blockquote>
<p>Determines which parent view controllerâ€™s view should be presented over for presentations of type UIModalPresentationCurrentContext.  If no ancestor view controller has this flag set, then the presenter will be the root view controller.</p>
</blockquote>
<p>ç®€å•æ¥è¯´ï¼Œå¦‚æœæŠŠä¸€ä¸ªæ§åˆ¶å™¨çš„<code>definesPresentationContext</code>å±æ€§è®¾ç½®ä¸ºYESï¼Œé‚£ä¹ˆåœ¨éœ€è¦è¿›è¡Œ<code>UIModalPresentationCurrentContext</code>ç±»å‹çš„è·³è½¬çš„æ—¶å€™ï¼ŒUIKitä¼šä½¿ç”¨è§†å›¾å±‚çº§å†…çš„è¿™ä¸ªæ§åˆ¶å™¨æ¥è¿›è¡Œè·³è½¬ã€‚</p>
<p>åœ¨<code>FirstViewController</code>ä¸­åŠ å…¥ä¸‹é¢çš„ä»£ç <br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[<span class="keyword">self</span>.navigationController setDefinesPresentationContext:<span class="literal">YES</span>];</div></pre></td></tr></table></figure></p>
<p>å¹¶åœ¨è·³è½¬çš„æ—¶å€™è®¾ç½®ç›®æ ‡æ§åˆ¶å™¨çš„<code>modalPresentationStyle</code></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[nav setModalPresentationStyle:<span class="built_in">UIModalPresentationCurrentContext</span>];</div><div class="line">[<span class="keyword">self</span> presentViewController:nav animated:<span class="literal">YES</span> completion:<span class="literal">nil</span>];</div></pre></td></tr></table></figure>
<p>æ¥ä¸‹æ¥çœ‹ä¸€ä¸‹Logæ—¥å¿—<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2016-12-18 11:59:20.041 PresentVCDemo[32336:22885768] viewDidLoad &lt;RootNavigationController: 0x7fd6f4810600&gt;</div><div class="line">2016-12-18 11:59:20.042 PresentVCDemo[32336:22885768] viewDidLoad &lt;ViewController: 0x7fd6f2c04110&gt;</div><div class="line">2016-12-18 11:59:20.052 PresentVCDemo[32336:22885768] viewDidLoad &lt;UINavigationController: 0x7fd6f381ce00&gt;</div><div class="line">2016-12-18 11:59:20.052 PresentVCDemo[32336:22885768] viewDidLoad &lt;FirstViewController: 0x7fd6f2f090c0&gt;</div><div class="line">2016-12-18 11:59:20.920 PresentVCDemo[32336:22885768] Presenting Controller : &lt;UINavigationController: 0x7fd6f381ce00&gt;</div></pre></td></tr></table></figure></p>
<p>å¤§åŠŸå‘Šæˆï¼ç°åœ¨<code>presentingViewController</code>èƒ½å¤Ÿè·å–åˆ°æˆ‘ä»¬æœŸæœ›çš„å¯¹è±¡äº†ã€‚</p></div><a href="/2016/12/18/ä½¿ç”¨presentingViewcontrollerå±æ€§å¯èƒ½ä¼šé‡åˆ°çš„å‘/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/08/09/NSProxyâ€”â€”å°‘è§å´ç¥å¥‡çš„ç±»/" class="post-title-link">NSProxyâ€”â€”å°‘è§å´ç¥å¥‡çš„ç±»</a></h2><div class="post-info">Aug 9, 2016</div><div class="post-content"><p>ä¼—æ‰€å‘¨çŸ¥ï¼ŒNSObjectç±»æ˜¯Objective-Cä¸­å¤§éƒ¨åˆ†ç±»çš„åŸºç±»ã€‚ä½†ä¸æ˜¯å¾ˆå¤šäººçŸ¥é“é™¤äº†NSObjectä¹‹å¤–çš„å¦ä¸€ä¸ªåŸºç±»â€”â€”NSProxy<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NS_ROOT_CLASS</span></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSProxy</span> &lt;<span class="title">NSObject</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªå¥‡æ€ªçš„ç±»æ˜¯å¹²å˜›çš„ï¼Ÿè¯·å…è®¸æˆ‘åšä¸€ä¸ªé»‘äººé—®å·è„¸<br>é©¬ä¸ŠæŸ¥äº†ä¸€ä¸‹Appleçš„å®˜æ–¹æ–‡æ¡£ï¼š<a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSProxy_Class/">NSProxy</a></p>
<blockquote>
<p>NSProxy is an abstract superclass defining an API for objects that act as stand-ins for other objects or for objects that donâ€™t exist yet. Typically, a message to a proxy is forwarded to the real object or causes the proxy to load (or transform itself into) the real object. Subclasses of NSProxy can be used to implement transparent distributed messaging (for example, <a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSDistantObject_Class/index.html#//apple_ref/occ/cl/NSDistantObject">NSDistantObject</a>) or for lazy instantiation of objects that are expensive to create.</p>
</blockquote>
<p>æ€»çš„æ¥è¯´ï¼ŒNSProxyæ˜¯ä¸€ä¸ªè™šç±»ï¼Œä½ å¯ä»¥é€šè¿‡ç»§æ‰¿å®ƒï¼Œå¹¶é‡å†™è¿™ä¸¤ä¸ªæ–¹æ³•ä»¥å®ç°æ¶ˆæ¯è½¬å‘åˆ°å¦ä¸€ä¸ªå®ä¾‹<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span>Â *)anInvocation;</div><div class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)sel;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨NSProxyçš„çœŸé¢ç›®ç»ˆäºæµ®å‡ºæ°´é¢ï¼š<strong>è´Ÿè´£å°†æ¶ˆæ¯è½¬å‘åˆ°çœŸæ­£çš„targetçš„ä»£ç†ç±»</strong>ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œä½ æƒ³è¦å–ä¸€ä»¶äºŒæ‰‹ç‰©å“ï¼Œä½†æ˜¯ä½ å¹¶ä¸æƒ³ç›´æ¥è·Ÿå–å®¶æ¥è§¦<strong>ï¼ˆç›´æ¥å‘targetå‘æ¶ˆæ¯ï¼‰</strong>ï¼Œè¿™æ—¶ä½ å»æ‰¾äº†ä¸€ä¸ªç¬¬ä¸‰æ–¹ï¼Œä½ å‘Šè¯‰è¿™ä¸ªç¬¬ä¸‰æ–¹ä½ è¦ä¹°ä»€ä¹ˆã€å‡ºå¤šå°‘é’±ä¹°ã€ä»€ä¹ˆæ—¶å€™è¦ç­‰<strong>ï¼ˆå‘ä»£ç†å‘æ¶ˆæ¯ï¼‰</strong>ï¼Œç¬¬ä¸‰æ–¹å†å»è·Ÿå–å®¶æ¥è§¦å¹¶æŠŠè¿™äº›ä¿¡æ¯è½¬å‘Šå–å®¶<strong>ï¼ˆè½¬å‘æ¶ˆæ¯ç»™çœŸå®çš„targetï¼‰</strong>ï¼Œæœ€åé€šè¿‡ç¬¬ä¸‰æ–¹å»å®Œæˆè¿™ä¸ªäº¤æ˜“ã€‚</p>
<p>äº†è§£å®ŒNSProxyæ˜¯æ˜¯ä»€ä¹ˆä»¥åï¼Œé‚£ä¹ˆå®ƒç©¶ç«Ÿèƒ½å¸®æˆ‘ä»¬å¹²äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p>
<p>##é€šè¿‡NSProxyåœ¨Objective-Cä¸­æ¨¡æ‹Ÿå¤šç»§æ‰¿</p>
<p>å¤šç»§æ‰¿åœ¨ç¼–ç¨‹ä¸­å¯ä»¥è¯´æ˜¯æ¯”è¾ƒæœ‰ç”¨çš„ç‰¹æ€§ã€‚ä¸¾ä¸ªä¾‹å­ï¼ŒåŸæœ¬æœ‰ä¸¤ä¸ªç›¸äº’ç‹¬ç«‹çš„ç±»Aå’Œç±»Bï¼Œå®ƒä»¬å„è‡ªç»§æ‰¿å„è‡ªçš„çˆ¶ç±»ï¼Œé¡¹ç›®è¿›è¡Œåœ°å¥½å¥½çš„ï¼Œçªç„¶æœ‰ä¸€å¤©äº§å“ç»ç†è¿‡æ¥å‘Šè¯‰ä½ ï¼Œæˆ‘è¦åœ¨ä¸‹ä¸ªç‰ˆæœ¬åŠ ä¸€ä¸ªxxxxxçš„ç‰¹æ€§ï¼Œéå¸¸ç´§æ€¥ã€‚ä¸€è„¸æ‡µé€¼çš„ä½ å‘ç°å¦‚æœè¦å®ç°è¿™ä¸ªç‰¹æ€§ï¼Œä½ éœ€è¦å¯¹ç±»Aä»¥åŠå…¶çˆ¶ç±»ä½œå¾ˆå¤§çš„ä¿®æ”¹ï¼Œä»£ä»·éå¸¸ä¹‹é«˜ã€‚çªç„¶ä½ æ„è¯†åˆ°åŸæ¥ç±»Bçš„çˆ¶ç±»å·²ç»æœ‰ç±»ä¼¼çš„åŠŸèƒ½ï¼Œä½ åªéœ€è¦è®©ç±»Aç»§æ‰¿äºç±»Bçš„çˆ¶ç±»å¹¶é‡å†™å…¶æŸäº›æ–¹æ³•å°±èƒ½å®ç°ï¼Œè¿™æ ·åšé«˜æ•ˆä¸”ä½é£é™©ï¼Œäºæ˜¯ä½ å±é¢ å±é¢ åœ°æ’¸èµ·äº†ä»£ç ã€‚</p>
<p>å¯æ˜¯ï¼ŒObjective-Cå´ä¸æ”¯æŒè¿™æ ·ä¸€ä¸ªå¼ºå¤§çš„ç‰¹æ€§ã€‚ä¸è¿‡NSProxyå¯ä»¥å¸®æˆ‘ä»¬åœ¨æŸç§ç¨‹åº¦ä¸Šï¼ˆè¿™åªæ˜¯ä¸€ä¸ªæ¨¡æ‹Ÿçš„å¤šç»§æ‰¿ï¼Œå¹¶ä¸æ˜¯å®Œå…¨çš„å¤šç»§æ‰¿ï¼‰è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<p><code>ç°åœ¨å‡è®¾æˆ‘ä»¬æƒ³è¦å»ä¹°ä¹¦ï¼Œä½†æ˜¯æˆ‘æ‡’ç™ŒçŠ¯äº†ï¼Œä¸æƒ³ç›´æ¥å»ä¹¦åº—ï¼ˆä¾›åº”å•†ï¼‰ä¹°ï¼Œå¦‚æœæœ‰ä¸€ä¸ªè·‘è…¿çš„äººï¼ˆç»é”€å•†ï¼‰å¸®æˆ‘å»ä¹¦åº—ä¹°å®Œï¼Œæˆ‘å†è·Ÿä»–ä¹°ã€‚åŒæ—¶ï¼Œæˆ‘ä¹°å®Œä¹¦åˆæƒ³ä¹°ä»¶è¡£æœï¼Œæˆ‘åˆå¯ä»¥å¾ˆè½»æ¾åœ°åœ¨ä»–é‚£é‡Œä¹°åˆ°ä¸€ä»¶è¡£æœï¼ˆå¤šç»§æ‰¿ï¼‰ã€‚</code></p>
<p>é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰BookProviderç±»ä¸ClothesProviderç±»ä½œä¸ºåŸºç±»ã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Â  TDBookProvider.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TDBookProviderProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseBookWithTitle:(<span class="built_in">NSString</span> *)bookTitle;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDBookProvider</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Â  TDClothesProvider.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span> (<span class="built_in">NSInteger</span>, TDClothesSize)&#123;</div><div class="line">Â  Â  TDClothesSizeSmall = <span class="number">0</span>,</div><div class="line">Â  Â  TDClothesSizeMedium,</div><div class="line">Â  Â  TDClothesSizeLarge</div><div class="line">&#125;;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">TDClothesProviderProtocol</span> &lt;<span class="title">NSObject</span>&gt;</span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseClothesWithSize:(TDClothesSize )size;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDClothesProvider</span> : <span class="title">NSObject</span></span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>è¿™é‡Œè¦æ³¨æ„ï¼š<strong>ä¸€å®šè¦é€šè¿‡protocolæ¥å£°æ˜æ¥å£ï¼Œè€Œä¸æ˜¯ç›´æ¥åœ¨ç±»çš„@interfereä¸­å®šä¹‰ã€‚</strong>å› ä¸ºé€šè¿‡protocolæ¥å£°æ˜æ¥å£ï¼Œç„¶åè®©proxyç±»éµå¾ªæ­¤åè®®ï¼Œå¯ä»¥éª—è¿‡ç¼–è¯‘å™¨é˜²æ­¢ç¼–è¯‘å™¨æç¤ºproxyç±»æœªå£°æ˜æ¥å£çš„é”™è¯¯ã€‚è¿™ä¸ªé—®é¢˜ä¸‹é¢å¯ä»¥çœ‹åˆ°ã€‚</p>
<p>ç„¶åæ˜¯è¿™ä¸¤ä¸ªç±»çš„å®ç°<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Â  TDBookProvider.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TDBookProvider.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDBookProvider</span> () &lt;<span class="title">TDBookProviderProtocol</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TDBookProvider</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseBookWithTitle:(<span class="built_in">NSString</span> *)bookTitle&#123;</div><div class="line">Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"You've bought \"%@\""</span>,bookTitle);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Â  TDClothesProvider.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TDClothesProvider.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDClothesProvider</span> () &lt;<span class="title">TDClothesProviderProtocol</span>&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TDClothesProvider</span></span></div><div class="line"></div><div class="line">- (<span class="keyword">void</span>)purchaseClothesWithSize:(TDClothesSize )size&#123;</div><div class="line">Â  Â  <span class="built_in">NSString</span> *sizeStr;</div><div class="line">Â  Â  <span class="keyword">switch</span> (size) &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">case</span> TDClothesSizeLarge:</div><div class="line">Â  Â  Â  Â  Â  Â  sizeStr = <span class="string">@"large size"</span>;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">break</span>;</div><div class="line">Â  Â  Â  Â  <span class="keyword">case</span> TDClothesSizeMedium:</div><div class="line">Â  Â  Â  Â  Â  Â  sizeStr = <span class="string">@"medium size"</span>;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">break</span>;</div><div class="line">Â  Â  Â  Â  <span class="keyword">case</span> TDClothesSizeSmall:</div><div class="line">Â  Â  Â  Â  Â  Â  sizeStr = <span class="string">@"small size"</span>;</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">break</span>;</div><div class="line">Â  Â  Â  Â  <span class="keyword">default</span>:</div><div class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">break</span>;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"You've bought some clothes of %@"</span>,sizeStr);</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure>
<p>ç°åœ¨ä¸¤ä¸ªProviderçš„ç±»å†™å®Œï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥å‘ä¾›åº”å•†ä¹°ä¸œè¥¿äº†ï¼Œä½†è¿™è·Ÿæˆ‘ä»¬çš„éœ€æ±‚è¿˜æœ‰å¾ˆå¤§å·®å¼‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸­é—´çš„ç»é”€å•†<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Â  TDDealerProxy.h</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"TDBookProvider.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">"TDClothesProvider.h"</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDDealerProxy</span> : <span class="title">NSProxy</span> &lt;<span class="title">TDBookProviderProtocol</span>, <span class="title">TDClothesProviderProtocol</span>&gt;</span></div><div class="line"></div><div class="line">+ (<span class="keyword">instancetype</span> )dealerProxy;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªè¦æ³¨æ„çš„é—®é¢˜ï¼š<br>1ã€TDDealerProxyè¿™ä¸ªå­ç±»å¿…é¡»è¦éµå¾ªä¹‹å‰å®šä¹‰çš„ä¸¤ä¸ªåè®®TDBookProviderProtocolä¸TDClothesProviderProtocolï¼Œç›®çš„æ˜¯éª—è¿‡ç¼–è¯‘å™¨ï¼Œè®©ç¼–è¯‘å™¨è®¤ä¸ºè¿™ä¸ªç±»å®ç°äº†ä¸Šé¢ä¸¤ä¸ªåè®®<br>2ã€NSProxyç±»æ˜¯æ²¡æœ‰initæ–¹æ³•çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬è¦è·å¾—ä¸€ä¸ªNSProxyçš„å®ä¾‹ï¼Œä»£ç åªéœ€è¦è¿™æ ·ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSProxy</span> *proxyInstance = [<span class="built_in">NSProxy</span> alloc];</div></pre></td></tr></table></figure></p>
<p>æ¥ä¸‹æ¥çœ‹å®ç°æ–‡ä»¶<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//Â  TDDealerProxy.m</span></div><div class="line"></div><div class="line"><span class="meta">#import <span class="meta-string">"TDDealerProxy.h"</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;objc/runtime.h&gt;</span></span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">TDDealerProxy</span> () </span>&#123;</div><div class="line">Â  Â  TDBookProviderÂ  Â  Â  Â  Â  *_bookProvider;</div><div class="line">Â  Â  TDClothesProvider Â  Â  Â  *_clothesProvider;</div><div class="line">Â  Â  <span class="built_in">NSMutableDictionary</span> Â  Â  *_methodsMap;</div><div class="line">&#125;</div><div class="line"><span class="keyword">@end</span></div><div class="line"></div><div class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">TDDealerProxy</span></span></div><div class="line"></div><div class="line"><span class="meta">#pragma mark - class method</span></div><div class="line">+ (<span class="keyword">instancetype</span>)dealerProxy&#123;</div><div class="line">Â  Â  <span class="keyword">return</span> [[TDDealerProxy alloc] init];</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - init</span></div><div class="line">- (<span class="keyword">instancetype</span>)init&#123;</div><div class="line">Â  Â  _methodsMap = [<span class="built_in">NSMutableDictionary</span> dictionary];</div><div class="line">Â  Â  _bookProvider = [[TDBookProvider alloc] init];</div><div class="line">Â  Â  _clothesProvider = [[TDClothesProvider alloc] init];</div><div class="line"></div><div class="line">    <span class="comment">//æ˜ å°„targetåŠå…¶å¯¹åº”æ–¹æ³•å</span></div><div class="line">Â  Â  [<span class="keyword">self</span> _registerMethodsWithTarget:_bookProvider];</div><div class="line">Â  Â  [<span class="keyword">self</span> _registerMethodsWithTarget:_clothesProvider];</div><div class="line"></div><div class="line">Â  Â  <span class="keyword">return</span> <span class="keyword">self</span>;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="meta">#pragma mark - private method</span></div><div class="line">- (<span class="keyword">void</span>)_registerMethodsWithTarget:(<span class="keyword">id</span> )target&#123;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">unsigned</span> <span class="keyword">int</span> numberOfMethods = <span class="number">0</span>;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">//è·å–targetæ–¹æ³•åˆ—è¡¨</span></div><div class="line">Â  Â  Method *method_list = class_copyMethodList([target <span class="keyword">class</span>], &amp;numberOfMethods);</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; numberOfMethods; i ++) &#123;</div><div class="line">Â  Â  Â  Â  <span class="comment">//è·å–æ–¹æ³•åå¹¶å­˜å…¥å­—å…¸</span></div><div class="line">Â  Â  Â  Â  Method temp_method = method_list[i];</div><div class="line">Â  Â  Â  Â  SEL temp_sel = method_getName(temp_method);</div><div class="line">Â  Â  Â  Â  <span class="keyword">const</span> <span class="keyword">char</span> *temp_method_name = sel_getName(temp_sel);</div><div class="line">Â  Â  Â  Â  [_methodsMap setObject:target forKey:[<span class="built_in">NSString</span> stringWithUTF8String:temp_method_name]];</div><div class="line">Â  Â  &#125;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  free(method_list);</div><div class="line">&#125;</div><div class="line"><span class="meta">#pragma mark - NSProxy override methods</span></div><div class="line">- (<span class="keyword">void</span>)forwardInvocation:(<span class="built_in">NSInvocation</span> *)invocation&#123;</div><div class="line">Â  Â  <span class="comment">//è·å–å½“å‰é€‰æ‹©å­</span></div><div class="line">Â  Â  SEL sel = invocation.selector;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">//è·å–é€‰æ‹©å­æ–¹æ³•å</span></div><div class="line">Â  Â  <span class="built_in">NSString</span> *methodName = <span class="built_in">NSStringFromSelector</span>(sel);</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">//åœ¨å­—å…¸ä¸­æŸ¥æ‰¾å¯¹åº”çš„target</span></div><div class="line">Â  Â  <span class="keyword">id</span> target = _methodsMap[methodName];</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">//æ£€æŸ¥target</span></div><div class="line">Â  Â  <span class="keyword">if</span> (target &amp;&amp; [target respondsToSelector:sel]) &#123;</div><div class="line">Â  Â  Â  Â  [invocation invokeWithTarget:target];</div><div class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</div><div class="line">Â  Â  Â  Â  [<span class="keyword">super</span> forwardInvocation:invocation];</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">- (<span class="built_in">NSMethodSignature</span> *)methodSignatureForSelector:(SEL)sel&#123;</div><div class="line">Â  Â  <span class="comment">//è·å–é€‰æ‹©å­æ–¹æ³•å</span></div><div class="line">Â  Â  <span class="built_in">NSString</span> *methodName = <span class="built_in">NSStringFromSelector</span>(sel);</div><div class="line">Â Â  Â </div><div class="line">Â  Â  <span class="comment">//åœ¨å­—å…¸ä¸­æŸ¥æ‰¾å¯¹åº”çš„target</span></div><div class="line">Â  Â  <span class="keyword">id</span> target = _methodsMap[methodName];</div><div class="line"></div><div class="line">Â  Â  <span class="comment">//æ£€æŸ¥target</span></div><div class="line">Â  Â  <span class="keyword">if</span> (target &amp;&amp; [target respondsToSelector:sel]) &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> [target methodSignatureForSelector:sel];</div><div class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</div><div class="line">Â  Â  Â  Â  <span class="keyword">return</span> [<span class="keyword">super</span> methodSignatureForSelector:sel];</div><div class="line">Â  Â  &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="keyword">@end</span></div></pre></td></tr></table></figure></p>
<p>å¤§åŠŸå‘Šæˆï¼Œç°åœ¨æˆ‘ä»¬çš„ç»é”€å•†ä¹Ÿæœ‰äº†ï¼Œæœ€åè¦åšçš„å°±æ˜¯å‘Šè¯‰ç»é”€å•†æˆ‘ä»¬è¦ä¹°ä»€ä¹ˆä¹¦è·Ÿä»€ä¹ˆè¡£æœäº†ï¼ˆå‘æ¶ˆæ¯ï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- (<span class="built_in">BOOL</span>)application:(<span class="built_in">UIApplication</span> *)application didFinishLaunchingWithOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</div><div class="line">Â Â  Â </div><div class="line">Â  Â  TDDealerProxy *dealerProxy = [TDDealerProxy dealerProxy];</div><div class="line">Â  Â  [dealerProxy purchaseBookWithTitle:<span class="string">@"Swift 100 Tips"</span>];</div><div class="line">Â  Â  [dealerProxy purchaseClothesWithSize:TDClothesSizeMedium];</div><div class="line"></div><div class="line">Â  Â  <span class="comment">// Override point for customization after application launch.</span></div><div class="line">Â  Â  <span class="keyword">return</span> <span class="literal">YES</span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œçœ‹çœ‹logï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">2016-08-06 01:10:27.095 TDProxyDemo[37732:924470] You&apos;ve bought &quot;Swift 100 Tips&quot;</div><div class="line">2016-08-06 01:10:27.095 TDProxyDemo[37732:924470] You&apos;ve bought some clothes of medium size</div></pre></td></tr></table></figure></p>
<p>Bravoï¼<a href="https://github.com/jojoting/TDProxyDemo">Demoåœ°å€æˆ³æˆ‘</a></p>
<p>æ€»çš„æ¥è¯´ï¼ŒNSProxyè¿™ä¸ªåœ¨æ—¥å¸¸å¼€å‘è€…å¾ˆå°‘è§çš„ç±»ï¼Œçš„ç¡®æœ‰ç€å®ƒå¥‡æ·«ä¹‹å¤„ï¼Œè¿™é‡Œæ¨èå‡ ä¸ªNSProxyç›¸å…³çš„å®è·µ</p>
<p><a href="http://blog.sunnyxx.com/2014/08/24/objc-duck/">objcä¸é¸­å­å¯¹è±¡ by sunny</a><br><a href="https://github.com/zwaldowski/BlocksKit">BlocksKit by zwaldowski</a><br>é™„ä¸Šä¸ªäººè§‰å¾—å†™å¾—å¾ˆå¥½çš„ä¸€ç¯‡æºç è§£æï¼š<br><a href="https://github.com/Draveness/iOS-Source-Code-Analyze/blob/master/BlocksKit/%E7%A5%9E%E5%A5%87%E7%9A%84%20BlocksKit%20%EF%BC%88%E4%B8%80%EF%BC%89.md">BlocksKitæºç è§£æï¼šã€Šç¥å¥‡çš„BlocksKit by Dravenessã€‹</a></p></div><a href="/2016/08/09/NSProxyâ€”â€”å°‘è§å´ç¥å¥‡çš„ç±»/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2016/07/20/é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½®pptp-vpn/" class="post-title-link">é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½®pptp-vpn</a></h2><div class="post-info">Jul 20, 2016</div><div class="post-content"><p>ç”±äºåšå®¢è¦æ¬å®¶åˆ°é˜¿é‡Œäº‘ï¼Œæ‰€ä»¥é¡ºä¾¿ä¹°äº†ä¸ªæ–°åŠ å¡çš„æœåŠ¡å™¨å‡†å¤‡è‡ªå·±é…ä¸€ä¸ªvpnï¼Œæ”¾å¼ƒä¹‹å‰ç”¨çš„é±¼æ‘†æ‘†ã€‚æ€»ä½“æ¥è¯´åœ¨é˜¿é‡Œäº‘ä¸Šé…ç½®vpnè¿˜ç®—æ¯”è¾ƒç®€å•ï¼ŒäºŒååˆ†é’Ÿå°±å¯ä»¥æ­å»ºå®Œæˆäº†ã€‚<br>æœåŠ¡å™¨æ“ä½œç³»ç»Ÿï¼šCentOS 6.5 32ä½<br>1ã€å®‰è£…PPPä»¥åŠPPTPPPP:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># yum install ppp</span></div></pre></td></tr></table></figure></p>
<p>PPTP:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># yum install pptp</span></div></pre></td></tr></table></figure></p>
<p>æ ¹æ®æç¤ºå®‰è£…å¥½å°±å¯ä»¥äº†<br>2ã€é…ç½®PPTPå®‰è£…å¥½PPTPåè¦å…ˆé…ç½®ä¸€ä¸‹PPTPï¼Œè¿›å…¥é…ç½®æ–‡ä»¶ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># vim /etc/pptpd.conf</span></div></pre></td></tr></table></figure></p>
<p>åœ¨æ–‡ä»¶æœ€åº•éƒ¨å¯ä»¥çœ‹è§ä¸¤è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#localip 192.168.0.1</div><div class="line">#remoteip 192.168.0.234-238,192.168.0.245</div></pre></td></tr></table></figure></p>
<p>æŠŠæ³¨é‡Šå»æ‰ï¼š<br><code>localip 192.168.0.1</code><br><code>remoteip 192.168.0.234-238,192.168.0.245</code><br>ç„¶åä¿å­˜é€€å‡ºå³å¯<br>ä¿®æ”¹å®Œé…ç½®æ–‡ä»¶åæˆ‘ä»¬è¿˜è¦ä¿®æ”¹ä¸€ä¸‹DNS<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># vim /etc/ppp/options.pptpd</span></div></pre></td></tr></table></figure></p>
<p>åŒæ ·åœ¨æ–‡ä»¶æœ€åä¸¤è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#ms-dns 10.0.0.1</div><div class="line">#ms-dns 10.0.0.2</div></pre></td></tr></table></figure></p>
<p>å»æ‰æ³¨é‡Šï¼Œå¹¶å°†DNSæ”¹ä¸º<br><code>ms-dns 8.8.8.8</code><br><code>ms-dns 8.8.4.4</code></p>
<p>ç„¶åä¿å­˜é€€å‡º<br><strong>æ³¨ï¼šæ­¤å¤„8.8.8.8ä¸8.8.4.4ä¸ºè°·æ­Œçš„DNSï¼Œå¯ä»¥æ ¹æ®ä¸ªäººæ”¹ä¸ºå…¶ä»–çš„ä¹Ÿå¯ä»¥</strong></p>
<p>æœ€åè¦è®¾ç½®ä¸€ä¸‹è´¦å·å¯†ç ï¼Œè¿›å…¥<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># vim /etc/ppp/chap-secrets</span></div></pre></td></tr></table></figure></p>
<p>è¿™ä¸ªæ–‡ä»¶åªæœ‰ä¸¤è¡Œï¼š<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># Secrets for authentication using CHAP</div><div class="line"># client server secret IP addresse</div></pre></td></tr></table></figure></p>
<p>æŒ‰ç…§æ–‡ä»¶æç¤ºçš„æ ¼å¼æ’å…¥ä¸€è¡Œå³å¯ï¼Œä¾‹å¦‚æ’å…¥ï¼š<br><code>guest pptp 123</code></p>
<p><strong>è¿™æ ·å°±ä»£è¡¨å¯ä»¥ä½¿ç”¨gusetè¿™ä¸ªè´¦å·ï¼Œå¯†ç æ˜¯123æ¥è¿æ¥VPNäº†</strong></p>
<p>3ã€ä¿®æ”¹å†…æ ¸è½¬å‘é…ç½®ç°åœ¨PPTPä»¥åŠé…ç½®å®Œæˆäº†ï¼Œåªéœ€è¦è®©å†…æ ¸æ”¯æŒè½¬å‘å°±å¯ä»¥äº†ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># vim /etc/sysctl.conf</span></div></pre></td></tr></table></figure></p>
<p>å°†<br><code>net.ipv4.ip_forward = 0</code>æ”¹ä¸º<code>net.ipv4.ip_forward = 1</code></p>
<p><code>net.ipv4.tcp_syncookies = 1</code>æ³¨é‡Šæ‰ï¼Œæ”¹ä¸º<code>#net.ipv4.tcp_syncookies = 1</code>ä¿å­˜é€€å‡ºåŒæ—¶æ‰§è¡Œå‘½ä»¤ä½¿å…¶ç”Ÿæ•ˆï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># sysctl -p</span></div></pre></td></tr></table></figure></p>
<p>æœ€åï¼Œè¿˜éœ€è¦æ·»åŠ iptablesçš„è½¬å‘è§„åˆ™ï¼š<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># iptables -t nat -A POSTROUTING -s 192.168.0.0/24 -o eth1 -jMASQUERADE</span></div></pre></td></tr></table></figure></p>
<p><strong>æ³¨ï¼šè¿™é‡Œç”±äºé˜¿é‡Œäº‘åŒç½‘å¡ï¼Œeth0æ˜¯å†…ç½‘ï¼Œeth1æ‰æ˜¯å¤–ç½‘ã€‚ç„¶åä¿å­˜ä¸€ä¸‹é…ç½®å¹¶é‡å¯iptables</strong><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># service iptables save</span></div><div class="line">[root@jojoServer ~]<span class="comment"># service iptables restart</span></div></pre></td></tr></table></figure></p>
<p>4ã€é‡å¯pptp<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[root@jojoServer ~]<span class="comment"># service pptpd restart</span></div></pre></td></tr></table></figure></p>
<p>5ã€è¿æ¥vpné€‰æ‹©é…ç½®å·²ç»å…¨éƒ¨å®Œæˆäº†ï¼Œå¯ä»¥åœ¨PCæˆ–ç§»åŠ¨ç«¯é€šè¿‡ä¹‹å‰æ·»åŠ çš„è´¦å·å¯†ç è¿æ¥å¹¶ä½¿ç”¨VPNäº†<br>6ã€é…ç½®å†…ç½‘ipä¸èµ°vpnç”±äºè¿æ¥VPNåé»˜è®¤æ‰€æœ‰çš„è¯·æ±‚éƒ½ä¼šèµ°VPNï¼Œæ‰€ä»¥æ‰“å¼€å›½å†…ç½‘ç«™å°±ä¼šæ¯”è¾ƒæ…¢å¦‚æœå¿å—ä¸äº†çš„ï¼Œå¯ä»¥åœ¨ç”µè„‘ä¸Šé…ç½®ä¸€ä¸‹è¿™é‡Œç»™ä¸ª<a href="https://github.com/jimmyxu/chnroutes">githubåœ°å€</a>é‡Œé¢æœ‰è¯¦ç»†çš„æ•™ç¨‹äº†ï¼Œlinuxï¼Œmac osï¼Œwindowséƒ½æ”¯æŒ<br>ç¥å¤§å®¶ç¿»å¢™æ„‰å¿«</p></div><a href="/2016/07/20/é˜¿é‡Œäº‘æœåŠ¡å™¨é…ç½®pptp-vpn/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/10/15/å®‰å…¨çš„NSArrayä¸NSMutableArrayæ“ä½œ/" class="post-title-link">å®‰å…¨çš„NSArrayä¸NSMutableArrayæ“ä½œ</a></h2><div class="post-info">Oct 15, 2015</div><div class="post-content"><p>æˆ‘ä»¬ä½¿ç”¨NSArrayæˆ–è€…NSMutableArrayæ—¶ï¼Œé€šå¸¸è°ƒç”¨<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">- (ObjectType)objectAtIndex:(<span class="built_in">NSUInteger</span>)index;</div></pre></td></tr></table></figure></p>
<p>æ¥é€šè¿‡ç´¢å¼•è·å–å¯¹è±¡ã€‚ä½†æ˜¯åœ¨ä½¿ç”¨è¿™ä¸ªæ–¹æ³•æ—¶ç»å¸¸ä¼šæŠ›å‡ºè¶Šç•Œçš„å¼‚å¸¸ï¼Œä¾‹å¦‚å®šä¹‰ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶è·å–æŒ‡å®šä¸‹æ ‡çš„å€¼ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSUInteger</span> index = <span class="number">4</span>;</div><div class="line"><span class="built_in">NSArray</span> *arr = [[<span class="built_in">NSArray</span> alloc]initWithObjects:<span class="string">@"1"</span>,<span class="string">@"2"</span>,<span class="string">@"3"</span>, <span class="literal">nil</span>];</div><div class="line"><span class="keyword">id</span> obj = [arr objectAtIndex:index];</div><div class="line">Â        <span class="built_in">NSLog</span>(<span class="string">@"object at index:%@"</span>,obj);</div></pre></td></tr></table></figure></p>
<p>è¿™æ—¶ä¼šå¯¼è‡´ç¨‹åºå‡ºé”™ï¼Œé”™è¯¯æ—¥å¿—ï¼š</p>
<blockquote>
<p><strong>*</strong> Terminating app due to uncaught exception â€˜NSRangeExceptionâ€™, reason: â€˜<strong>* -[__NSArrayI objectAtIndex:]: index 4 beyond bounds [0 .. 2]â€™</strong></p>
</blockquote>
<p>å°±æ˜¯æˆ‘ä»¬ç»å¸¸é‡åˆ°çš„æ•°ç»„è¶Šç•Œé—®é¢˜ï¼Œä¸ºäº†é¿å…è¿™ç§é—®é¢˜çš„å‘ç”Ÿï¼Œæˆ‘ä»¬åº”è¯¥å¯¹è¦ç©¿å…¥çš„ç´¢å¼•å€¼è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœè¶…å‡ºäº†æ•°ç»„çš„è¾¹ç•Œï¼Œå°±åº”è¯¥ç›´æ¥è¿”å›ç©ºå€¼ã€‚ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">Â  Â  Â  Â  <span class="built_in">NSUInteger</span> index = <span class="number">4</span>;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSArray</span> *arr = [[<span class="built_in">NSArray</span> alloc]initWithObjects:<span class="string">@"1"</span>,<span class="string">@"2"</span>,<span class="string">@"3"</span>, <span class="literal">nil</span>];</div><div class="line">Â  Â  Â  Â  <span class="keyword">id</span> obj = <span class="literal">nil</span>;</div><div class="line">Â  Â  Â  Â  <span class="keyword">if</span> (index &gt; arr.count) &#123;</div><div class="line">Â  Â  Â  Â  Â  Â  obj = <span class="literal">nil</span>;</div><div class="line">Â  Â  Â  Â  &#125;<span class="keyword">else</span>&#123;</div><div class="line">Â  Â  Â  Â  Â  Â  obj = [arr objectAtIndex:index];</div><div class="line">Â  Â  Â  Â  &#125;</div><div class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"object at index:%@"</span>,obj);</div></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœï¼š</p>
<blockquote>
<p><strong>object at index:(null)</strong></p>
</blockquote>
<p>å› æ­¤ï¼Œæˆ‘ä»¬å¦‚æœéœ€è¦é¿å…æ•°ç»„è¶Šç•Œå‘ç”Ÿï¼Œæœ‰å¿…è¦å¯¹ç´¢å¼•å€¼è¿›è¡Œä¸€æ¬¡åˆ¤æ–­ï¼Œä½†å¦‚æœåœ¨å·¥ç¨‹ä¸­æ¯ä¸€å¤„éƒ½åŠ åˆ¤æ–­æœªå…è¿‡äºéº»çƒ¦ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªNSArrayçš„categoryæ‰©å±•ç±»ï¼Œå¹¶é‡å†™<figure class="highlight plain"><figcaption><span>)index```æ–¹æ³•ã€‚</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">```objc</div><div class="line">- (id)safe_objectAtIndex:(NSUInteger )index&#123;</div><div class="line">Â  Â  if (index &gt; self.count || index &lt; 0) &#123;</div><div class="line">Â  Â  Â  Â  //indexè¶…å‡ºæ•°ç»„ç•Œé™</div><div class="line">Â  Â  Â  Â  return nil;</div><div class="line">Â  Â  &#125;</div><div class="line">Â  Â  return [self objectAtIndex:index];</div></pre></td></tr></table></figure></p>
<p>ä½†åŒæ—¶æˆ‘ä»¬åº”æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚æœé€šè¿‡è¿™ç§æ–¹å¼å¼ºåˆ¶æ€§é¿å…äº†è¶Šç•Œå¯¼è‡´çš„å¼‚å¸¸ï¼Œå¯èƒ½ä¼šä½¿å·¥ç¨‹ä¸­çš„å…¶å®ƒéƒ¨åˆ†å—åˆ°ä¸€å®šç¨‹åº¦çš„å½±å“ã€‚å› æ­¤åº”é€‰æ‹©æ€§åœ°ä½¿ç”¨æ­¤æ–¹æ³•ã€‚</p>
<p><a href="https://github.com/jojoting/TDSafeArray">githubåœ°å€</a></p></div><a href="/2015/10/15/å®‰å…¨çš„NSArrayä¸NSMutableArrayæ“ä½œ/" class="read-more">...more</a></article></li><li class="post-list-item"><article class="post-block"><h2 class="post-title"><a href="/2015/10/13/nilæŒ‡é’ˆå¯¹NSDictionaryåŠNSArrayåˆå§‹åŒ–çš„å½±å“/" class="post-title-link">nilæŒ‡é’ˆå¯¹NSDictionaryåŠNSArrayåˆå§‹åŒ–çš„å½±å“</a></h2><div class="post-info">Oct 13, 2015</div><div class="post-content"><p>æœ€è¿‘åœ¨åšé¡¹ç›®çš„æ—¶å€™é‡åˆ°ä¸€ä¸ªæŒºå‘çš„å´©æºƒé—®é¢˜ï¼Œæ˜¯ç”±äºNSDictionaryåˆå§‹åŒ–æ—¶nilæŒ‡é’ˆå¼•èµ·çš„å´©æºƒã€‚å‡è®¾æˆ‘ä»¬ç°åœ¨è¦åˆå§‹åŒ–ä¸€ä¸ª{key1 : value1, key2 : value2, key3 : value3}çš„NSDictionaryï¼Œä¸€èˆ¬æœ‰ä¸¤ç§åˆå§‹åŒ–æ–¹æ³•ï¼š</p>
<p>1ã€ä½¿ç”¨æ ‡å‡†çš„åˆå§‹åŒ–æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSDictionary</span> *dictionary ï¼[[<span class="built_in">NSDictionaryalloc</span>] initWithObjectsAndKeys:value1,<span class="string">@"key1"</span>,value2,<span class="string">@"key2"</span>, value3 ,<span class="string">@"value3"</span>,<span class="literal">nil</span>];</div></pre></td></tr></table></figure></p>
<p>2ã€ä½¿ç”¨ios6.0ä»¥åæ–°æ”¯æŒçš„åˆå§‹åŒ–æ–¹æ³•ï¼š<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSDictionary</span> *dictionary =@&#123;<span class="string">@"key1"</span> : value1,<span class="string">@"key2"</span> : value2,<span class="string">@"key3"</span> : value3&#125;;</div></pre></td></tr></table></figure></p>
<p>ç°åœ¨æˆ‘ä»¬å¯¹value1 value2 value3è¿›è¡Œèµ‹å€¼ï¼Œå¹¶æŠŠvalue2è®¾ä¸ºnilæŒ‡é’ˆ:<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="built_in">NSString</span> *value1 =<span class="string">@"value1"</span>;<span class="built_in">NSString</span> *value2 =<span class="literal">nil</span>;<span class="built_in">NSString</span> *value3 =<span class="string">@"value3"</span>;</div></pre></td></tr></table></figure></p>
<p>è¿™æ—¶å¦‚æœä½¿ç”¨ç¬¬äºŒç§åˆå§‹åŒ–æ–¹æ³•ï¼Œè¿è¡Œç¨‹åºä¼šå‘ç°å´©æºƒï¼Œæ—¥å¿—å¦‚ä¸‹ï¼š</p>
<blockquote>
<p>DictionaryTextDemo[29390:1329578]<strong><em> Terminating app due to uncaught exception â€˜NSInvalidArgumentExceptionâ€™, reason: â€˜</em></strong> -[__NSPlaceholderDictionary initWithObjects:forKeys:count:]: attempt to insert nil object from objects[1]â€™</p>
</blockquote>
<p>å‘ç°ç³»ç»Ÿä¼šé˜»æ­¢ä½ å‘object[1]æ’å…¥ä¸€ä¸ªnilæŒ‡é’ˆï¼ŒæŸ¥è¯¢è‹¹æœå®˜æ–¹æ–‡æ¡£å¾—åˆ°</p>
<blockquote>
<p>Discussion<br>This method steps through the objects andkeys arrays, creating entries in the new dictionary as it goes. AnNSInvalidArgumentException is raised if a key or value object isnil.</p>
</blockquote>
<p>ä¹Ÿå°±æ˜¯è¯´ä½¿ç”¨è¿™ç§åˆå§‹åŒ–æ–¹æ³•çš„æ—¶å€™å¿…é¡»ä¿è¯keyè·Ÿvalueéƒ½ä¸ä¸ºnilï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åœ¨åˆå§‹åŒ–ä¹‹å‰å¯¹å…¶è¿›è¡Œåˆ¤æ–­ï¼Œå¦‚æœä¸ºnilå°±ä¸åŠ å…¥å­—å…¸ã€‚ä½†æ˜¯å¦‚æœæœ‰éœ€æ±‚è®©valueå¿…é¡»ä¸ºç©ºçš„æ—¶å€™ï¼Œå¯ä»¥å°†valueèµ‹å€¼ä¸º<code>[NSNull null]</code>è¿™æ ·å°±å¯ä»¥æˆåŠŸæ’å…¥å­—å…¸ï¼Œæœ€åæ‰“å°å‡ºæ¥çš„ç»“æœæ˜¯</p>
<blockquote>
<p>DictionaryTextDemo[29510:1338517] dictionary : {key1 = value1;key2 = â€œâ€;value3 = value3;}</p>
</blockquote>
<p>å¦ä¸€ç§è§£å†³æ–¹æ³•å°±æ˜¯ä½¿ç”¨æ ‡å‡†çš„åˆå§‹åŒ–æ–¹æ³•ï¼Œå³ç¬¬ä¸€ç§åˆå§‹åŒ–æ–¹æ³•ã€‚ä½†åŒæ—¶ä¹Ÿè¦æ³¨æ„ä¸€ä¸ªé—®é¢˜ï¼Œä½¿ç”¨<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">NDictionary *dictionary = [[<span class="built_in">NSDictionaryalloc</span>]initWithObjectsAndKeys:value1,<span class="string">@"key1"</span>,value2,<span class="string">@"key2"</span>, value3 ,<span class="string">@"value3"</span>,<span class="literal">nil</span>];</div></pre></td></tr></table></figure></p>
<p>å¦‚æœæˆ‘ä»¬æŠŠå…¶ä¸­ä¸€ä¸ªkeyæˆ–è€…valueè®¾ä¸ºnilæŒ‡é’ˆï¼Œé‚£ä¹ˆç³»ç»Ÿä¼šåˆ¤æ–­ä¸ºå…¨éƒ¨å¯¹è±¡æ’å…¥å®Œæˆï¼Œå³ç›¸å½“äºæˆ‘ä»¬åˆå§‹åŒ–æ•°ç»„åŠå­—å…¸æ—¶æœ€åçš„nilã€‚å› æ­¤è¿™ç§æ–¹æ³•è™½ç„¶èƒ½é¿å…æ’å…¥nilæŒ‡é’ˆæ—¶æŠ›å‡ºçš„å¼‚å¸¸ï¼Œä½†å¯èƒ½ä¼šæˆä¸ºä¸€ä¸ªå·¥ç¨‹ä¸­å¾ˆå¤§çš„å®‰å…¨éšæ‚£ï¼Œå¹¶ä¸”éš¾ä»¥å‘ç°ã€‚æ‰€ä»¥æ¨èä½¿ç”¨ç¬¬äºŒç§åˆå§‹åŒ–æ–¹æ³•ï¼Œå¹¶å¯¹nilæŒ‡é’ˆè¿›è¡Œå¿…è¦çš„åˆ¤æ–­ï¼Œé€‰æ‹©æ€§ä½¿ç”¨<code>[NSNull null]</code>æ¥å®ç°ç‰¹ç‚¹çš„éœ€æ±‚ã€‚åŒç†ï¼Œä½¿ç”¨NSArrayæ—¶ä¹Ÿåº”è¯¥æ³¨æ„è¿™ç±»é—®é¢˜ã€‚</p></div><a href="/2015/10/13/nilæŒ‡é’ˆå¯¹NSDictionaryåŠNSArrayåˆå§‹åŒ–çš„å½±å“/" class="read-more">...more</a></article></li></ul></section><footer><div class="paginator"></div><div class="copyright"><p>Â© 2016 <a href="https://dingtz.com">Jojo Ding</a>, powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/pinggod/hexo-theme-apollo" target="_blank">hexo-theme-apollo</a>.</p></div></footer></div><script async src="//cdn.bootcss.com/mathjax/2.6.1/MathJax.js?config=TeX-MML-AM_CHTML"></script></body></html>